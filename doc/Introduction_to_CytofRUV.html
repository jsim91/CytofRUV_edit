<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to CytofRUV</title>

<style type="text/css">
a.anchor-section {margin-left: 10px; visibility: hidden; color: inherit;}
a.anchor-section::before {content: '#';}
.hasAnchor:hover a.anchor-section {visibility: visible;}
</style>
<script>// Anchor sections v1.0 written by Atsushi Yasumoto on Oct 3rd, 2020.
document.addEventListener('DOMContentLoaded', function() {
  // Do nothing if AnchorJS is used
  if (typeof window.anchors === 'object' && anchors.hasOwnProperty('hasAnchorJSLink')) {
    return;
  }

  const h = document.querySelectorAll('h1, h2, h3, h4, h5, h6');

  // Do nothing if sections are already anchored
  if (Array.from(h).some(x => x.classList.contains('hasAnchor'))) {
    return null;
  }

  // Use section id when pandoc runs with --section-divs
  const section_id = function(x) {
    return ((x.classList.contains('section') || (x.tagName === 'SECTION'))
            ? x.id : '');
  };

  // Add anchors
  h.forEach(function(x) {
    const id = x.id || section_id(x.parentElement);
    if (id === '') {
      return null;
    }
    let anchor = document.createElement('a');
    anchor.href = '#' + id;
    anchor.classList = ['anchor-section'];
    x.classList.add('hasAnchor');
    x.appendChild(anchor);
  });
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>





<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to CytofRUV</h1>



<div id="introduction-to-cytofruv" class="section level1">
<h1>Introduction to CytofRUV</h1>
<p>CytofRUV is a computational algorithm which permits the integration of data across CyTOF batches. We provided an introduction here that explains step by step how to load and normalise datasets and also how to visualise the diagnostic plots using the R-Shiny application before and after CytofRUV normalisation.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>We provided an example of a set of data that included all .fcs, a metadata file a and panel file in the inst/extdata. First of all we need to load all the packages.</p>
</div>
<div id="dataset" class="section level2">
<h2>Dataset</h2>
<p>Users are required to provide: the path to the fcs files from all the samples in the study, a metadata file containing the details of each sample and their respective .fcs files, and a panel file containing the details of all proteins used in the study. The metadata file is an excel file with the following column names: “file_name”, “sample_id”, “condition”, “patient_id”, “batch”. The panel file is an excel file with the following column names: “fcs_colname”, “antigen”, “marker_class”.</p>
<p>We provided an example dataset to help you prepare your data. The command below will load all the dataset including the metadata file, the panel file and the fcs files in the working directory.</p>
<pre><code>[1] &quot;/Users/trussart.m/WEHI/R_Package/CytofRUV/vignettes/CytofRUV_output/CytofRUV_output/A1.fcs&quot;
[1] &quot;/Users/trussart.m/WEHI/R_Package/CytofRUV/vignettes/CytofRUV_output/CytofRUV_output/A2.fcs&quot;
[1] &quot;/Users/trussart.m/WEHI/R_Package/CytofRUV/vignettes/CytofRUV_output/CytofRUV_output/Run3_A1.fcs&quot;
[1] &quot;/Users/trussart.m/WEHI/R_Package/CytofRUV/vignettes/CytofRUV_output/CytofRUV_output/Run3_A2.fcs&quot;</code></pre>
</div>
<div id="loading-datasets-and-clustering" class="section level2">
<h2>Loading datasets and clustering</h2>
<p>The first step is to load the metadata file, all the .fcs files, the panel file from the dataset. The user needs to define the working directory as well as the filename of the metadata file and the panel file. Once the dataset is loaded, after applying an arcsinh transformation (cofactor 5), all the data will be clustered. The user needs to provide the number of clusters to be used for this dataset.</p>
<pre><code>[1] &quot;Reading MetaData&quot;
[1] &quot;Reading fcs files&quot;
             name             desc    range minRange maxRange
$P1          Time             &lt;NA&gt; 15248628        0 15248627
$P2  Event_length             &lt;NA&gt;       94        0       93
$P3         Y89Di         89Y_CD45     2410        0     2409
$P4       Pd102Di    102Pd_Barcode    20694        0    20693
$P5       Pd104Di    104Pd_Barcode    24736        0    24735
$P6       Pd105Di    105Pd_Barcode    24619        0    24618
$P7       Pd106Di    106Pd_Barcode    20195        0    20194
$P8       Pd108Di    108Pd_Barcode    23303        0    23302
$P9       Pd110Di    110Pd_Barcode    20908        0    20907
$P10      In115Di     115In_HLA-DR     4659        0     4658
$P11      La139Di            139La    17653        0    17652
$P12      Ce140Di 140Ce_CD27_MT271    23401        0    23400
$P13      Pr141Di    141Pr_CD235ab    20716        0    20715
$P14      Nd142Di       142Nd_CD19    12575        0    12574
$P15      Nd143Di        143Nd_CD5    13286        0    13285
$P16      Nd144Di       144Nd_CD38     4375        0     4374
$P17      Nd145Di        145Nd_CD4     1661        0     1660
$P18      Nd146Di        146Nd_CD8     3366        0     3365
$P19      Sm147Di       147Sm_CD20    14397        0    14396
$P20      Nd148Di       148Nd_CD16     2340        0     2339
$P21      Eu151Di      151Eu_CD123    14973        0    14972
$P22      Eu153Di     153Eu_Bcl-xL    37056        0    37055
$P23      Sm154Di    154Sm_Bax_1B4     8837        0     8836
$P24      Gd155Di       155Gd_CD56     2154        0     2153
$P25      Gd156Di       156Gd_CD14    15853        0    15852
$P26      Gd157Di      157Gd_Bcl-2    29777        0    29776
$P27      Tb159Di      159Tb_CD11c     2290        0     2289
$P28      Gd160Di      160Gd_Mcl-1     1252        0     1251
$P29      Dy161Di       161Dy_cMyc     3241        0     3240
$P30      Dy163Di      163Dy_BFL-1    35013        0    35012
$P31      Ho165Di        165Ho_Bim    28808        0    28807
$P32      Er166Di        166Er_pRb     1595        0     1594
$P33      Er167Di       167Er_CD27      715        0      714
$P34      Er168Di       168Er_PUMA    17910        0    17909
$P35      Tm169Di     169Tm_CD45RA     5446        0     5445
$P36      Er170Di        170Er_CD3    13066        0    13065
$P37      Yb171Di       171Yb_CD66     6918        0     6917
$P38      Yb172Di      172Yb_BCL-W    32300        0    32299
$P39      Yb173Di  173Yb_cCaspase3    10011        0    10010
$P40      Yb174Di        174Yb_p53     3874        0     3873
$P41      Ir191Di       191Ir_DNA1    31341        0    31340
$P42      Ir193Di       193Ir_DNA2    39168        0    39167
$P43      Pt194Di  194Pt_Cisplatin    37287        0    37286
$P44      Pt195Di  195Pt_Cisplatin    37573        0    37572
$P45      Bi209Di       209Bi_CD61    58960        0    58959
$P46       Center             &lt;NA&gt;     6732        0     6731
$P47       Offset             &lt;NA&gt;      670        0      669
$P48        Width             &lt;NA&gt;      325        0      324
$P49     Residual             &lt;NA&gt;      846        0      845
[1] &quot;Read Panel File&quot;
[1] &quot;Checking panel colNames&quot;
[1] &quot;Checking panel values&quot;
 [1] &quot;Eu153Di&quot; &quot;Sm154Di&quot; &quot;Gd157Di&quot; &quot;Gd160Di&quot; &quot;Dy161Di&quot; &quot;Dy163Di&quot; &quot;Ho165Di&quot;
 [8] &quot;Er166Di&quot; &quot;Er168Di&quot; &quot;Yb172Di&quot; &quot;Yb173Di&quot; &quot;Yb174Di&quot; &quot;Y89Di&quot;   &quot;In115Di&quot;
[15] &quot;Pr141Di&quot; &quot;Nd142Di&quot; &quot;Nd143Di&quot; &quot;Nd144Di&quot; &quot;Nd145Di&quot; &quot;Nd146Di&quot; &quot;Sm147Di&quot;
[22] &quot;Nd148Di&quot; &quot;Eu151Di&quot; &quot;Gd155Di&quot; &quot;Gd156Di&quot; &quot;Tb159Di&quot; &quot;Er167Di&quot; &quot;Tm169Di&quot;
[29] &quot;Er170Di&quot; &quot;Yb171Di&quot; &quot;Bi209Di&quot;
NULL
[1] &quot;Formatting Data&quot;
[1] &quot;Completed creating DaFrame Objects&quot;</code></pre>
</div>
<div id="r-shiny-interface-before-cytofruv-normalisation" class="section level2">
<h2>R-Shiny interface before CytofRUV normalisation</h2>
<p>To examine the batch effects found when comparing CyTOF data from samples replicated across batches, we built an R-Shiny application that exhibits any batch effects present in samples replicated across batches using four different diagnostics plots: Median Protein Expression, Protein Expression Distributions, Clustering Results and Cluster Proportions.</p>
<p>The user needs to select the data to use (before or after normalisation) to visualise the diagnostic plots using the R-Shiny interface. The user can choose to visualise all the data or only a subset of the data which might be advisable for exploratory analysis.</p>
</div>
<div id="cytofruv-normalisation-procedure" class="section level2">
<h2>CytofRUV normalisation procedure</h2>
<p>TThe normalize_data function allow the user to adjust for batch effects with parameter settings for the CytofRUV algorithm, such as which replicated samples to use and the value of k. The user can specify below the name of the directory to save the normalised data (dir_name_norm_data) or use the get_directory function which will ask the user to specify the directory. The normalised files and the metadata and panel files will be save into the specified directory.</p>
</div>
<div id="loading-and-clustering-the-data-after-cytofruv-normalisation" class="section level2">
<h2>Loading and clustering the data after CytofRUV normalisation</h2>
<p>The first step is to load the metadata file, all the .fcs files, the panel file from the dataset. The user needs to define the working directory as well as the filename of the metadata file and the panel file. Once the dataset is loaded, after applying an arcsinh transformation (cofactor 5), all the data will be clustered. The user needs to provide the number of clusters to be used for this dataset.</p>
<pre><code>[1] &quot;Reading MetaData&quot;
[1] &quot;Reading fcs files&quot;
        name            desc    range   minRange maxRange
$P1     Time            &lt;NA&gt; 15248628  0.0000000 15248627
$P2    Y89Di        89Y_CD45     2410 -0.4510004     2409
$P3  In115Di    115In_HLA-DR     4659 -1.1074120     4658
$P4  Pr141Di   141Pr_CD235ab    20716 -3.3255489    20693
$P5  Nd142Di      142Nd_CD19    12575 -1.1849808    24735
$P6  Nd143Di       143Nd_CD5    13286 -1.1990349    24618
$P7  Nd144Di      144Nd_CD38     4375 -2.5586534    20194
$P8  Nd145Di       145Nd_CD4     1661 -3.2051425    23302
$P9  Nd146Di       146Nd_CD8     3366 -2.4574041    20907
$P10 Sm147Di      147Sm_CD20    14397 -0.6710566    14396
$P11 Nd148Di      148Nd_CD16     2340 -1.4539309     2339
$P12 Eu151Di     151Eu_CD123    14973 -1.2618363    14972
$P13 Gd155Di      155Gd_CD56     2154 -2.2674949     2153
$P14 Gd156Di      156Gd_CD14    15853 -1.9339695    15852
$P15 Tb159Di     159Tb_CD11c     2290 -1.7672182     2289
$P16 Er167Di      167Er_CD27      715 -1.2433747      714
$P17 Tm169Di    169Tm_CD45RA     5446 -3.0584748     5445
$P18 Er170Di       170Er_CD3    13066 -2.4981380    13065
$P19 Yb171Di      171Yb_CD66     6918 -1.4444346     6917
$P20 Bi209Di      209Bi_CD61    58960 -3.0733371    58959
$P21 Eu153Di    153Eu_Bcl-xL    37056 -3.4634755    37055
$P22 Sm154Di   154Sm_Bax_1B4     8837 -2.8547149     8836
$P23 Gd157Di     157Gd_Bcl-2    29777 -2.8946040    29776
$P24 Gd160Di     160Gd_Mcl-1     1252 -1.4401959     1251
$P25 Dy161Di      161Dy_cMyc     3241 -4.6729655     3240
$P26 Dy163Di     163Dy_BFL-1    35013 -0.2315303    35012
$P27 Ho165Di       165Ho_Bim    28808 -0.9914662    28807
$P28 Er166Di       166Er_pRb     1595 -2.5360601     1594
$P29 Er168Di      168Er_PUMA    17910 -5.2390504    17909
$P30 Yb172Di     172Yb_BCL-W    32300 -0.7381380    32299
$P31 Yb173Di 173Yb_cCaspase3    10011 -2.3261936    10010
$P32 Yb174Di       174Yb_p53     3874 -0.8569174     3873
[1] &quot;Read Panel File&quot;
[1] &quot;Checking panel colNames&quot;
[1] &quot;Checking panel values&quot;
 [1] &quot;Eu153Di&quot; &quot;Sm154Di&quot; &quot;Gd157Di&quot; &quot;Gd160Di&quot; &quot;Dy161Di&quot; &quot;Dy163Di&quot; &quot;Ho165Di&quot;
 [8] &quot;Er166Di&quot; &quot;Er168Di&quot; &quot;Yb172Di&quot; &quot;Yb173Di&quot; &quot;Yb174Di&quot; &quot;Y89Di&quot;   &quot;In115Di&quot;
[15] &quot;Pr141Di&quot; &quot;Nd142Di&quot; &quot;Nd143Di&quot; &quot;Nd144Di&quot; &quot;Nd145Di&quot; &quot;Nd146Di&quot; &quot;Sm147Di&quot;
[22] &quot;Nd148Di&quot; &quot;Eu151Di&quot; &quot;Gd155Di&quot; &quot;Gd156Di&quot; &quot;Tb159Di&quot; &quot;Er167Di&quot; &quot;Tm169Di&quot;
[29] &quot;Er170Di&quot; &quot;Yb171Di&quot; &quot;Bi209Di&quot;
NULL
[1] &quot;Formatting Data&quot;
[1] &quot;Completed creating DaFrame Objects&quot;</code></pre>
</div>
<div id="r-shiny-interface-after-cytofruv-normalisation" class="section level2">
<h2>R-Shiny interface after CytofRUV normalisation</h2>
<p>The R-shiny interface can also be used to visualise the normalised data.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
